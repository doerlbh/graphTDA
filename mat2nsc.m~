% dat2mat
% extract n-dimensional simplicial complexes from data matrix

% Author:       Baihan Lin
% Affliation:   Rabadan Lab, Columbia University
% Date:         04/2018

function nsc = mat2nsc(dist, best_eps, ss, st, d)

N = size(dist, 2);
nsc = zeros(st,d);
for s = 1:st
    select = randsample(N,ss);
    graph = [dist(select,select) <= best_eps];
    betti_0 = int64(ss - (sum(sum(graph)) - ss) / 2);
    nsc(s, d);
end

[~, ph] = max(sum(barcode(2:end,:),2));
ph = ph + 1;

pph = barcode(ph,:) / sum(barcode(ph,:));
best_eps = sum(pph .* epsilon);
best_idx = int64(sum(pph .* [1:100]));
disp(num2str(best_idx))

imagesc(barcode); hold on
colormap(flipud(gray))
caxis('auto')
colorbar
ylabel('number of scomplexes')
xlabel('\epsilon')
title('Persistent homology of \beta_0')
line([best_idx best_idx],[0 ss],'Color',[1 0 0]);

end